---
title: "Apurva Mahajan - Detroit"
output: html_document
date: "2025-04-22"
---


## Story pitch:

**rsw comment: let's revise to first describe the story pitch. then describe the problems. the two are conflated here and it's hard to follow the significance of what you are pursuing.**

After my initial analysis, I've found that two counties in Michigan --- Oscoda and Keweenaw --- have seen the highest drops in immunization rates for three of the four major vaccine series, and consistently fell in the bottom three for lowest MMR vaccination rates in the state. These two counties also have some of the lowest populations in the state, which could potentially indicate that more rural areas are seeing larger drops in their vaccination rates for children. 

I've joined the vaccination report card data to Census ACS data from 2023 on population for each county, and am working on joining election data to this to see if there's a pattern between vaccination rates and how people voted in the 2024 and 2016 elections. I'd like to see the proportion of votes allocated toward the Republican Party and the Democratic Party for each of the counties in Michigan, and I want to perform a more robust analysis for these counties beyond what I found of the two counties that immediately stand out. I also plan on looking at the vaccination rates for the MMR vaccine alone. I've found the csv for this from the Michigan government and will load it in as I continue work on this story. The measles vaccine, which is included in each of the four vaccine series I'm analyzing, is primarily administered to young children and adolescents. There have been 9 reported measles cases this year in Michigan so far, in Ingham, Kent, Macomb, Marquette, Montcalm and Oakland Counties, making this the worst year in decades for measles in Michigan.

## Limitations:

I would like to make my methodology as sound as possible, since certain series could only be recommended for certain age ranges, so I'm planning to do some more research on this. However, there's not much online publicly, so I'm a little stuck until I talk to an expert, such as a Michigan epidemiologist, who can provide me more context on this data, since these vaccine series are only used by the state's department of health and human services.

------------------------------------------------------------------------


**rsw comment: integrate the underlined material below into your narrative and code**


# Load software libraries

```{r}
#install.packages("tidyverse")
#install.packages("janitor")
#install.packages("readxl")
#install.packages("rvest")
#install.packages("tidycensus")
#install.packages("DT")

library(tidyverse)
library(janitor)
library(readxl)
library(rvest)
library(tidycensus)
library(DT)


```

# Load data + initial cleaning

```{r}

# The report card data provides estimates for immunization coverage at the county level for vaccines recommended for children (19-35 months) and adolescent (13-17-year-olds)

# load in vaccine report card data
report_card_data <- read.csv("../data/Report_card_All_data_20250313.csv") |> 
    clean_names()

# How many counties?
report_card_data$cntyname %>% 
  unique()
# Michigan has 83 counties. There are 85 unique county values, because this data set includes Detroit City and the State of Michigan's vaccination report cards.

# I'm creating a column based on an index so I can plot this and analyze by time. 

#rsw comment: do you really need to have 76 columns at this point? can you narrow it down?

report_card_data <- report_card_data %>% 
  mutate(
     quarter_num = as.numeric(sub("Q", "", quarter)),
     quarter_index = year + (quarter_num - 1) / 4,
    quarter_date = make_date(year, (quarter_num - 1) * 3 + 1, 1)
  )

```

# Percent change analysis for four childhood vaccination series over the past decade

#rsw comment: break out each one of these, provide an english translation for each of the vaccine series 4313314 = "a polio vaccine" and display them using a datatable

datatable(DF, caption = "XXXX", options = list(pageLength = 20))

```{r}
### PERCENT CHANGE IN VACCINATION COVERAGE

##rsw comment: define 4313314, 43133142, 132321, 1323213. editors will have no idea what you're talking about

# For this analysis, I'm focusing on the vaccine series 4313314, 43133142, 132321, 1323213, and the MMR vaccine. These are the series Michigan recommends for children and adolescents. 

``` 

## 4313314 series: 

- 4 or more doses of DTaP/DTP/DT
- 3 or more doses of Polio
- 1 or more dose of MMR
- 3 or more doses of Hib
- 3 or more doses of HepB
- 1 or more dose of Varicella
- 4 or more doses of PCV. 

```{r}
# Let's look at the 4313314 series: "4 or more doses of DTaP/DTP/DT, 3 or more doses of Polio, 1 or more dose of MMR, 3 or more doses of Hib, 3 ore more doses of HepB, 1 or more dose of Varicella, 4 or more doses of PCV." 

# Coverage for the 4313314 vaccine decreased for all but three counties in Michigan. Oscoda and Keweenaw Counties nearly halved their vaccine coverage for this series. 

#rsw comment - so how many people are not vaccinated for polio now by county?

series_1 <- report_card_data %>% 
  group_by(cntyname) %>% 
  filter(quarter_index %in% c(2014.75, 2024.75)) %>% 
  select(cntyname, quarter_index, covg4313314) %>% 
  pivot_wider(
    names_from = quarter_index,
    values_from = covg4313314,
    names_prefix = "Q_"
  ) %>% 
  mutate(pct_change_2014_2024 = 100 * (Q_2024.75 - Q_2014.75) / Q_2014.75) %>% 
  arrange(pct_change_2014_2024)

datatable(series_1, options = list(pageLength = 20))


```

## 43133142 series:

- 4 or more doses of DTaP/DTP/DT
- 3 or more doses of Polio
- 1 or more dose of MMR
- 3 or more doses of Hib
- 3 or more doses of Hep B
- 1 or more dose of Varicella
- 4 or more doses of PCV
- 2 or more doses of HepA

```{r}
 
## Again, Oscoda and Keweenaw are in the top two counties that have nearly halved their vaccine coverage for this series.
series_2 <- report_card_data %>% 
  group_by(cntyname) %>% 
  filter(quarter_index %in% c(2014.75, 2024.75)) %>% 
  select(cntyname, quarter_index, covg43133142) %>% 
  pivot_wider(
    names_from = quarter_index,
    values_from = covg43133142,
    names_prefix = "Q_"
  ) %>% 
  mutate(pct_change_2014_2024 = 100 * (Q_2024.75 - Q_2014.75) / Q_2014.75) %>% 
  arrange(pct_change_2014_2024)

datatable(series_2, options = list(pageLength = 20))


```

## 132321 series:

- 1 or more doses of Tdap
- 3 or more doses of Polio
- 2 or more doses of MMR 
- 3 or more doses of HepB 
- 2 or more doses of Varicella 
- 1 or more dose of MenACWY

```{r}

#### 132321 SERIES ####
##This series did not have as high percent change decreases, but Keewenaw is in the top five here too. 
series_3 <- report_card_data %>% 
  group_by(cntyname) %>% 
  filter(quarter_index %in% c(2014.75, 2024.75)) %>% 
  select(cntyname, quarter_index, covg132321) %>% 
  pivot_wider(
    names_from = quarter_index,
    values_from = covg132321,
    names_prefix = "Q_"
  ) %>% 
  mutate(pct_change_2014_2024 = 100 * (Q_2024.75 - Q_2014.75) / Q_2014.75) %>% 
  arrange(pct_change_2014_2024)

datatable(series_3, options = list(pageLength = 20))


```

## 1323213 series:

- 1 or more doses of Tdap
- 3 or more doses of Polio
- 2 or more doses of MMR
- 3 or more doses of HepB
- 2 or more doses of Varicella
- 1 or more dose of MenACWY
- HPV complete (with 2 or 3 doses (Males & Females))


``` {r}
#### 1323213 SERIES ####
# Nearly all counties have increased their coverage of this series. I'm wondering the reason behind this, and if it is significant. Could this change be because this is a new vaccine series that only started being implemented recently? Would love to talk to a Michigan epidemiologist who works for the state DHHS or some other expert to understand this. 
series_4 <- report_card_data %>% 
  group_by(cntyname) %>% 
  filter(quarter_index %in% c(2014.75, 2024.75)) %>% 
  select(cntyname, quarter_index, covg1323213) %>% 
  pivot_wider(
    names_from = quarter_index,
    values_from = covg1323213,
    names_prefix = "Q_"
  ) %>% 
  mutate(pct_change_2014_2024 = 100 * (Q_2024.75 - Q_2014.75) / Q_2014.75) %>% 
  arrange(pct_change_2014_2024)

datatable(series_4, options = list(pageLength = 20))


```


# Aggregated analysis

``` {r}


# I'm focusing on the vaccine series 4313314, 43133142, 132321, 1323213, and the MMR vaccine. These are the series Michigan recommends for children and adolescents. 

# Create a column that has an unweighted average of all four of these series. Also group by year instead of quarter to more easily see yearly changes.
report_card_data_aggregated <- report_card_data %>% 
  mutate(series_agg = (covg4313314 + covg43133142 + covg132321 + covg1323213)/4) %>% 
  select(cntyname, quarter_index, quarter_date, series_agg) %>% 
  mutate(year = floor(quarter_index)) %>%   
  group_by(cntyname, year) %>%
  summarize(mean_vax_rate = mean(series_agg, na.rm = TRUE))



# Let's look at the 
report_card_data_aggregated %>% 
  filter(cntyname == "Keweenaw") %>% 
  ggplot(aes(x=year)) +
  geom_line(aes(y = mean_vax_rate)) +
  labs(title = "Coverage Over Time in Keweenaw County",
       y = "Coverage Value",
       x = "Quarter",
       color = "Coverage Type") +
  theme_minimal()


# Ten-year percent change for aggregated vaccine series
report_card_data_aggregated %>% 
  group_by(cntyname) %>% 
  pivot_wider(
    names_from = year,
    values_from = mean_vax_rate,
    names_prefix = "Y_"
  ) %>% 
   mutate(pct_change_2014_2024 = 100 * (Y_2024 - Y_2014) / Y_2014) %>% 
  select(cntyname, pct_change_2014_2024) %>% 
  arrange(pct_change_2014_2024)

```

# Population analysis

```{r}

# Let's look at populations for these counties.

###### DELETE API KEY BEFORE PUSHING!!!!! ######

# Load 2023 ACS population data from tidycensus
vars <- load_variables(2023, "acs1") 

# 2023 Census population by county
pop_by_county <- get_acs(
  geography = "county",
  variables = "B01001A_001",
  state = "MI",
) %>% clean_names()

# Cleaning census data set's names to get rid of extra text like "County"
pop_by_county$name <- sub(" County.*", "", pop_by_county$name)

report_card_with_pop <- report_card_data %>% 
  inner_join(pop_by_county, join_by(cntyname == name)) %>% 
  select(
    cntyname, quarter_index, covg4313314, covg43133142, covg132321, covg1323213, estimate
  )

# Keewenaw is the county with the smallest population, with 2,021 people. 
report_card_with_pop %>%
  filter(quarter_index == "2023.75") %>% 
  group_by(cntyname) %>% 
  arrange(estimate)

# A reason there might be less people getting these vaccine series could potentially be because there are less children in the county? Since this is the least populated county, if children continue to grow up, there may no longer be a need to get these vaccine series. 



report_card_data %>% 
  filter(cntyname == "Keweenaw") %>% 
  ggplot(aes(x=quarter_index)) +
  geom_line(aes(y = covg4313314, color = "covg4313314")) +
  geom_line(aes(y = covg43133142, color = "covg43133142")) +
  geom_line(aes(y = covg132321, color = "covg132321")) +
  geom_line(aes(y = covg1323213, color = "covg1323213")) +
  labs(title = "Coverage Over Time in Keweenaw County",
       y = "Coverage Value",
       x = "Quarter",
       color = "Coverage Type") +
  theme_minimal()
```

``` {r}

election_16 <- read.csv("../data/2016_US_County_Level_Presidential_Results.csv") %>%  clean_names()
  
election_20 <- read.csv("../data/2020_US_County_Level_Presidential_Results.csv") %>% clean_names
  
election_24 <- read.csv("../data/2024_US_County_Level_Presidential_Results.csv") %>% clean_names

# Filtering for just Michigan Counties
mi_election_16 <- election_16 %>% 
  filter(state_abbr == "MI")
mi_election_20 <- election_20 %>% 
  filter(state_name == "Michigan")
mi_election_24 <- election_24 %>% 
  filter(state_name == "Michigan")

# cleaning the names so they don't have "County" appended, since we're joining based on name
mi_election_16$county_name <- sub(" County.*", "", mi_election_16$county_name)
mi_election_20$county_name <- sub(" County.*", "", mi_election_20$county_name)
mi_election_24$county_name <- sub(" County.*", "", mi_election_24$county_name)

# Let's look at the average vaccine coverage by county in just election years.

vaccine_election_2016 <- report_card_data_aggregated %>% 
  group_by(cntyname) %>% 
  pivot_wider(
    names_from = year,
    values_from = mean_vax_rate,
    names_prefix = "Y_"
  ) %>% 
  inner_join(mi_election_16, by = c("cntyname" = "county_name")) %>% 
  select(cntyname, Y_2016, total_votes, per_dem, per_gop)  


vaccine_election_2020 <- report_card_data_aggregated %>% 
  group_by(cntyname) %>% 
  pivot_wider(
    names_from = year,
    values_from = mean_vax_rate,
    names_prefix = "Y_"
  ) %>% 
  inner_join(mi_election_20, by = c("cntyname" = "county_name")) %>% 
  select(cntyname, Y_2020, total_votes, per_dem, per_gop)

vaccine_election_2024 <- report_card_data_aggregated %>% 
  group_by(cntyname) %>% 
  pivot_wider(
    names_from = year,
    values_from = mean_vax_rate,
    names_prefix = "Y_"
  ) %>% 
  inner_join(mi_election_24, by = c("cntyname" = "county_name")) %>% 
  select(cntyname, Y_2024, total_votes, per_dem, per_gop, per_point_diff)
  
write.csv(vaccine_election_2016, "../data/test.csv")



```

``` {r}

# Plotting elections + vaccine results using a geoJSON of Michigan counties

# install.packages("gridExtra")
library(sf)
library(gridExtra)

mi_counties <- read_sf("../data/County.geojson") %>% clean_names()

# plotting to make sure it looks right
ggplot(mi_counties) +
  geom_sf(fill = "#69b3a2", color = "white") +
  theme_void()

# joining geoJSON to aggregate childhood vaccination data 

vaccines_24 <- mi_counties %>% 
  inner_join(vaccine_election_2024, by = c("name" = "cntyname")) %>% 
  ggplot() +
  geom_sf(aes(fill = Y_2024)) +
  theme_void()


mi_election_map_24 <- mi_counties %>% 
  inner_join(vaccine_election_2024, by = c("name" = "cntyname")) %>% 
  ggplot() +
  geom_sf(aes(fill = per_point_diff)) +
  scale_fill_gradient(
    low = "#0041C2",
    high = "#e51d37"
  ) +
  theme_void()


grid.arrange(vaccines_24, mi_election_map_24, ncol = 2)
```


# Analysis by age of series

## The 43... series are administered to children 19-35 months, while the 

# MMR vaccine analysis

```{r}

# Let's look at MMR vaccination rates as of Dec. 31, 2024 (end of 2024 Q4)

report_card_data %>% 
  filter(
    year == "2024",
    quarter == "Q4"
  ) %>% 
  select(year, quarter, cntyname, covgmmr) %>% 
  arrange(covgmmr) %>% 
  slice(1:10)

report_card_data %>% 
  filter(
    year == "2024",
    quarter == "Q3"
  ) %>% 
  select(year, quarter, cntyname, covgmmr) %>% 
  arrange(covgmmr) %>% 
  slice(1:10)

report_card_data %>% 
  filter(
    year == "2024",
    quarter == "Q2"
  ) %>% 
  select(year, quarter, cntyname, covgmmr) %>% 
  arrange(covgmmr) %>% 
  slice(1:10)

# Oscoda County had the lowest MMR vaccination rates, followed by Keweenaw, Gladwin, Mackinac and Salinac. None of these counties saw measles cases in 2025.


```

# Questions

Write down questions you want answered:

# Potential sources:

Thrishika Bala, epidemiologist for the state of Michigan
Lynn Sutfin, PIO for Michigan DHHS, SutfinL1\@michigan.gov

# Data Details
[This website explains the different Series numbers for the sets of vaccines: <https://www.michigan.gov/mdhhs/adult-child-serv/childrenfamilies/immunizations/data-statistics/countyimmsreportcards>]{.underline}

Source: <https://www.michigan.gov/mdhhs/adult-child-serv/childrenfamilies/immunizations/data-statistics/countyimmsreportcards>

Documentation: <https://www.michigan.gov/mdhhs/-/media/Project/Websites/mdhhs/Adult-and-Childrens-Services/Children-and-Families/Immunization-Information/LHD/Immunization-Report-Cards/Report_Card_Defs__FAQs_2021.pdf?rev=93e4ac10b66c4c10abcd3c02a6b55982&hash=EA6122E84CB516E9E6D335CC73BDB5CF>
